<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script type="text/javascript" src="script.js"></script>
  <script type="text/javascript" src="targetclient.browser.js"></script>
</head>
<body>
<div id="result"></div>
<script type="text/javascript">

  var queryString = window.location.search;
  var urlParams = new URLSearchParams(queryString);

  var doLocalDecisioning = urlParams.get('local') !== null;

  var client;

  var context = {
    "userAgent": navigator.userAgent,
    "timeOffsetInMinutes": -420,
    "channel": "web",
    "screen": {"width": 1920, "height": 1200, "orientation": "landscape", "colorDepth": 24, "pixelRatio": 2},
    "window": {"width": 1920, "height": 677},
    "browser": {"host": "waters-local"},
    "address": {"url": "http://waters-local/#/", "referringUrl": "http://waters-local/"}
  };

  var visitorId = {
    "tntId": "338e3c1e51f7416a8e1ccba4f81acea0.28_0",
    "marketingCloudVisitorId": "07327024324407615852294135870030620007",
  };

  var targetRequest = {
    "id": visitorId,
    "context": context
  };

  function getOffers() {

    client.getOffers({
      request: Object.assign({}, targetRequest, {
        prefetch: {
          pageLoad: {
            parameters: {
              foo: "bar"
            }
          },
          mboxes: [
          //   {
          //     name: "jason-flags",
          //     index: 1
          //   }
          //   ,
            {
              name: "browser-mbox",
              index: 2
            }
            // ,
            // {
            //   name: "expendable-mbox",
            //   index: 3
            // }
            // ,
            // {
            //   name: "superfluous-mbox",
            //   index: 4
            // }
            // ,
            // {
            //   name: "redundant-mbox",
            //   parameters: {
            //     foo: "bar"
            //   },
            //   index: 5
            // }
            // ,
            // {
            //   name: "something",
            //   index: 6
            // }
            // ,
            // {
            //   name: "kitty",
            //   index: 7
            // }
            // ,
            // {
            //   name: "vanilla-mbox",
            //   index: 8
            // }
          ],
          // views: [{}]
        },
        // execute: {
        //   pageLoad: {
        //     parameters: {
        //       foo: "bar"
        //     }
        //   }
        // }
      }),
      sessionId: "dummy_session"
    }).then(function (res) {
      showResult("Result: Success", JSON.stringify(res.response, null, 4));
    }).catch(function (err) {
      showResult("Result: Error", err.toString());
    });

    // client.getAttributes(['jason-flags'], {
    //   request: targetRequest,
    //   sessionId: "dummy_session"
    // }).then(function (features) {
    //   console.log(features.asObject('jason-flags'));
    //   console.log(features.getValue('jason-flags', 'paymentExperience'));
    // });

  }

  var targetClientOptions = {
    client: "adobesummit2018",
    organizationId: "65453EA95A70434F0A495D34@AdobeOrg",
    clientReadyCallback: getOffers
  };

  client = window.TargetClient.create(Object.assign({}, targetClientOptions, doLocalDecisioning ? {
    executionMode: "local",
    artifactLocation: "rules.json"
    // artifactLocation: "https://target-local-decisioning-staging.s3.us-east-2.amazonaws.com/adobesummit2018/waters_test/rules.json"
  } : {}));
</script>
</body>
</html>
